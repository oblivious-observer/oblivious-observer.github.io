<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-08-29 Sat 15:30 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>oblivious</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Oblivious Observer" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<script src="/static/jquery.min.js"></script>
<script src="/static/jquery.slim.min.js"></script>
<script src="/static/popper.min.js"></script>
<link rel="stylesheet" href="/static/bootstrap.min.css">
<script src="/static/bootstrap.min.js"></script>
<script src="/static/bootstrap.bundle.min.js"></script>
<link rel="stylesheet" href="/static/roboto.txt">
<style type="text/css">body{ padding: 5em 20%;}</style>
<style type="text/css">code { color: #808080;}</style>
<style type="text/css">pre { padding: 0pt;}</style>
<style type="text/css">.navbar { margin:0 !important; padding: 0px !important; } </style>
<style type="text/css"> .title{ font-family: SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace; }</style>
<style type="text/css"> .title{ color: #808080; font-weight: 500; line-height: 1.2; }</style>
<link rel="stylesheet" href="/static/github.css">
<script src="/static/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

        <style>
        /* From: https://endlessparentheses.com/public/css/endless.css */
        /* See also: https://meta.superuser.com/questions/4788/css-for-the-new-kbd-style */
        kbd
        {
          -moz-border-radius: 6px;
          -moz-box-shadow: 0 1px 0 rgba(0,0,0,0.2),0 0 0 2px #fff inset;
          -webkit-border-radius: 6px;
          -webkit-box-shadow: 0 1px 0 rgba(0,0,0,0.2),0 0 0 2px #fff inset;
          background-color: #f7f7f7;
          border: 1px solid #ccc;
          border-radius: 6px;
          box-shadow: 0 1px 0 rgba(0,0,0,0.2),0 0 0 2px #fff inset;
          color: #333;
          display: inline-block;
          font-family: 'Droid Sans Mono', monospace;
          font-size: 80%;
          font-weight: normal;
          line-height: inherit;
          margin: 0 .1em;
          padding: .08em .4em;
          text-shadow: 0 1px 0 #fff;
          word-spacing: -4px;

          box-shadow: 2px 2px 2px #222; /* MA: An extra I've added. */
        }
        </style>
        <link rel="stylesheet" type="text/css" href="https://alhassy.github.io/org-special-block-extras/tooltipster/dist/css/tooltipster.bundle.min.css"/>

        <link rel="stylesheet" type="text/css" href="https://alhassy.github.io/org-special-block-extras/tooltipster/dist/css/plugins/tooltipster/sideTip/themes/tooltipster-sideTip-punk.min.css" />

        <script type="text/javascript">
            if (typeof jQuery == 'undefined') {
                document.write(unescape('%3Cscript src="https://code.jquery.com/jquery-1.10.0.min.js"%3E%3C/script%3E'));
            }
        </script>

         <script type="text/javascript"            src="https://alhassy.github.io/org-special-block-extras/tooltipster/dist/js/tooltipster.bundle.min.js"></script>

          <script>
                 $(document).ready(function() {
                     $('.tooltip').tooltipster({
                         theme: 'tooltipster-punk',
                         contentAsHTML: true,
                         animation: 'grow',
                         delay: [100,500],
                         // trigger: 'click'
                         trigger: 'custom',
                         triggerOpen: {
                             mouseenter: true
                         },
                         triggerClose: {
                             originClick: true,
                             scroll: true
                         }
         });
                 });
             </script>

        <style>
           abbr {color: red;}

           .tooltip { border-bottom: 1px dotted #000;
                      color:red;
                      text-decoration: none;}
        </style>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:1f739d935676111cfff4b4693e3816e664797050&amp;dn=gpl-3.0.txt GPL-v3-or-Later
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.cacheClassElem = elem.className;
         elem.cacheClassTarget = target.className;
         target.className = "code-highlighted";
         elem.className   = "code-highlighted";
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(elem.cacheClassElem)
         elem.className = elem.cacheClassElem;
       if(elem.cacheClassTarget)
         target.className = elem.cacheClassTarget;
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="preamble" class="status">
<!-- [[file:~/blog/readme.org::*Navigation][Navigation:1]] -->
<nav class="navbar fixed-top navbar-expand-lg navbar-light bg-light">
  <div class="container">

  <a class="navbar-brand" href="/"> <img src="/static/observer.png" width="35" height="35" class="d-inline-block align-top" alt=""> </a>


  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="nav navbar-nav ml-auto w-100 justify-content-left">
      <li class="nav-item">
        <a class="nav-link" href="/"> Oblivious Observer </a>
      </li>
    </ul>
    <ul class="nav navbar-nav ml-auto w-100 justify-content-end">
      <li class="nav-item">
        <a class="nav-link" href="/about">about</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/config">config</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="https://github.com/observer/observer.github.io">src</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/tags">tags</a>
      </li>
    </ul>
  </div>
  </div>
</nav>
<!-- Navigation:1 ends here -->
</div>
<div id="content">
<h1 class="title">oblivious</h1>
<p>
<code>oblivious</code> is a static site generator written in <code>emacs-lisp</code>, <code>bash</code> and
<code>org-mode</code>. It is designed to be minimalistic and extensible at the same time
and consists of a CLI written in under 100 lines of bash. The configuration of
the site is done using org-mode.
</p>

<p>
The general idea is to grab a copy of oblivious and then to create a
<code>readme.org</code> file at the root of your directory in order to configure your site:
</p>

<pre class="example">
# tree -a
.
├── bin
│   └── oblivious
└── readme.org
</pre>

<p>
Now initialize the new site and depending on what you&rsquo;ve configured in your
<code>readme.org</code> something like this will be created. Note that the <code>init</code> command
also injects the configuration of your emacs export setup into your existing
emacs configuration (that is if you use vanilla or doom emacs):
</p>
<pre class="example">
# bin/oblivious init
# tree -a
.
├── assets  &lt;-------------------- you store stuff you created yourself here, e.g. pictures, logos, ...
├── bin  &lt;----------------------- the bin folder is where scripts used by oblivious can be tangled to
│   ├── .get_resources
│   ├── .git_user_info
│   └── oblivious
├── .config  &lt;------------------- this folder contains elisp files, such as the sites org-publish configuration
│   └── org-publish.el
├── .dir-locals.el  &lt;------------ use this to set up custom properties of your site, e.g. local org-ref setup or author and email for org-mode
├── .gitignore  &lt;---------------- apart from content everything autogenerated should be added to the .gitignore file
├── index
│   └── index.org  &lt;------------- this could be the landingpage of the site
├── partials  &lt;------------------ autogenerated html files 
│   ├── footer.html
│   └── header.html
├── posts  &lt;--------------------- posts stores blog posts, e.g.: posts/how-to-use-oblivious/{index.org,img/example.png}
├── public  &lt;-------------------- this is where the finished site is exported to
├── readme.org  &lt;---------------- configuration of the site, contains src_blocks, which are loaded and/or tangled
├── static  &lt;-------------------- this is where stuff such as javascript will be downloaded into (unlike assets you don't keep track of this)
└── templates  &lt;----------------- contains org files which are tangled from the readme.org. Enable them with '#+include:...' or '#+setupfile:...'
</pre>

<p>
Currently <code>oblivious</code> supports the following commands:
</p>
<pre class="example">
# bin/oblivious

Description:
oblivious is a bit of glue built around org-publish. It enables you to quickly set up a nice little website or blog with bash, emacs and orgmode.

Obliviously you have no idea how to use this, you wouldn't be here otherwise.

Here are some pointers:

Usage:
  oblivious [command]

Commands:
  init      Init and inject org-publish config into your ~/.doom.d/config.el or ~/.emacs.d/init.el
  sync      Load settings from your readme.org
  fetch     Fetches resources you have defined (css and fonts)
  build     Runs org-publish and creates your website
  observe   TODO I really need to add this one: watch for file changes in the parent directory and its children, autorebuild
  release   TODO Rebuild and add a signed commit with automated commit message, etc.
  *         Display this Help
</pre>

<p>
At this point it is noteworthy that in order to make everything extensible, I
set up <code>oblivious</code> to check if custom scripts are existing and if so just
execute those instead of the built-in funcitonality: for example if the file
<code>bin/.init</code> exists, the <code>oblivious init</code> command would execute it, instead of
the built-in init commands. This way you are able to customize pretty much
everything oblivious does.
</p>

<p>
Also there are a few things I&rsquo;d like to mention as well:
</p>
<ul class="org-ul">
<li>external resources are meant to be fetched, the general idea is to write a
bunch of src blocks, which will be tangled into a download script. You don&rsquo;t
have to do this, but I found it to bequite handy and it makes self hosting and
minimizing external resources quite simple.</li>
<li>this started out as a quick weekend project and while I think I&rsquo;ve actually
built something quite nice, it currently is in more of a &rsquo;works for me&rsquo; state
than a polished product. I&rsquo;m now two weekends in and have included most of the
functionality I would like to have on my site, but I&rsquo;m pretty sure a bunch of
the underlying things should definitely be reworked.</li>
<li>while I&rsquo;m using org-publish here it is entirely possible to set up a different
exporting backend such as ox-hugo.</li>
<li>I&rsquo;ve build <code>oblivious</code> with pipelines in mind, so one of my goals for this
project is to be able to unattendedly batch export a site with the same
results you get when exporting it from an emacs session</li>
<li>a few things I did, are not necessarily the best defaults to what you want to
use: e.g. the batch processing steps are actually loading my emacs config,
instead of just executing a bit of elisp.</li>
<li>I have no idea how to use CSS, HTML and I&rsquo;m no expert in bash, org-mode or
emacs-lisp, so expect a fair amount of cargo culting, when you read this
document.</li>
<li>A bunch of the examples might be a bit unintuitive. For example: the knowledge
graph is being tangled to an org-file, which contains an bash src block. This
bash src block is then executed and it&rsquo;s output is put into the tangled org
document. This Output of the bash block is an export block which contains raw
html, that is then directly embedded into the knowledge graph portion of the
html export. The generated org file is then imported into the tags list using
&rsquo;#+include&rsquo;. So basically things can get a bit complicated if you want them to
be and sometimes, stuff like proper escaping can be quite important. You don&rsquo;t
need to do something like this, it works for me.</li>
<li>Since the examples are quite unintuitive for I&rsquo;ll probably split them up
properly at a later point in time and make sure to document them properly.</li>
</ul>
<div id="outline-container-org6d6b6e3" class="outline-2">
<h2 id="org6d6b6e3">Outlook and Future Work: A collection of Patterns for Publishers</h2>
<div class="outline-text-2" id="text-org6d6b6e3">
<p>
At a later point in time I would very much like to see oblivious turn into a
tool, which provides a collection of patterns users can then reference in order
to set everything up. Specifically I&rsquo;m thinking about something like this, where
the <code>readme.org</code> files contain handy bits and pieces of fancy configuration
users can simply include and start using in order to set up a site:
</p>
<pre class="example">
├── bin
│   └── oblivious
├── doc
│   ├── bootstrap
│   │   └── readme.org
│   ├── exampleusers_custom_bootstrap_fork
│   │   └── readme.org
│   ├── visjs
│   │   └── readme.org
... ...
└── readme.org
</pre>

<p>
The rest of this document contains everything necessary to create this little
blog. For now it serves as example of what can be done to set up a minimalistic
little site using <code>oblivious</code> (some information is not part of the html export,
e.g. setting configured in property drawers).
</p>

<p>
Have fun and enjoy!
</p>
</div>
</div>
<div id="outline-container-org08ed84e" class="outline-2">
<h2 id="org08ed84e">Set up some Variables</h2>
<div class="outline-text-2" id="text-org08ed84e">
<p>
Lets begin with who I am, I don&rsquo;t want the author and email address of my
exports to be set to something other than the following:
</p>
<div class="org-src-container">
<pre><code class="conf" id="org2532b77">Oblivious Observer
</code></pre>
</div>

<p>
In order to avoid automatic crawlers to find our email address from the
<code>.dir-locals.el</code> or the git commit history, use the super secure caesar chiffre:
</p>

<div class="org-src-container">
<pre><code class="conf" id="orgdbf7ba9">\"echo 5oyvivbhf?5ofreire[ng]cebgbaznvy?pbz | tr [0-9A-Za-z.?] [5-90-4N-ZA-Mn-za-m?.]\"
</code></pre>
</div>

<p>
Set up the working directory of the site:
</p>
<div class="org-src-container">
<pre><code class="conf" id="orgafec859">~/blog
</code></pre>
</div>

<details class="code-details"> <summary> <strong> <font face="Courier" size="3" color="green"> <span style="color:black;">org-mode source</span> </font> </strong> </summary> <p>

</p>
<div class="org-src-container">
<pre><code class="org">Lets begin with who I am, I don't want the author and email address of my
exports to be set to something other than the following:
#+name: oblivious_name
#+BEGIN_SRC conf
Oblivious Observer
#+END_SRC

In order to avoid automatic crawlers to find our email address from the
~.dir-locals.el~ or the git commit history, use the super secure caesar chiffre:

#+name: oblivious_email
#+BEGIN_SRC conf
\"echo 5oyvivbhf?5ofreire[ng]cebgbaznvy?pbz | tr [0-9A-Za-z.?] [5-90-4N-ZA-Mn-za-m?.]\"
#+END_SRC

Set up the working directory of the site:
#+name: oblivious_working_directory
#+BEGIN_SRC conf
~/#+STARTUP: showall indent
  #+STARTUP: hidestars
  #+BEGIN_HTML
  ---
  layout: default
  title: title
  excerpt: excerpt
  ---

#+END_SRC
</code></pre>
</div>
 </details>
</div>
</div>
<div id="outline-container-org52688be" class="outline-2">
<h2 id="org52688be">Configuring git config</h2>
<div class="outline-text-2" id="text-org52688be">
<p>
The following block will make sure the <code>.git/config</code> file does not leak personal information:
</p>
<div class="org-src-container">
<pre><code class="bash">if grep -q "^\[user\]$" .git/config
then
  sed -i 's/name = .*/name = Oblivious Observer/g;s/email = .*/email = &lt;&lt;oblivious_email&gt;&gt;/g' .git/config
else
  echo "
[user]
        email = \"echo 5oyvivbhf?5ofreire[ng]cebgbaznvy?pbz | tr [0-9A-Za-z.?] [5-90-4N-ZA-Mn-za-m?.]\"
        name = Oblivious Observer
" &gt;&gt; .git/config
fi
</code></pre>
</div>
</div>
</div>
<div id="outline-container-org06ba3f9" class="outline-2">
<h2 id="org06ba3f9">Override org-mode variables</h2>
<div class="outline-text-2" id="text-org06ba3f9">
<p>
We also want emacs to use different values for name and email address in this
repository:
</p>
<div class="org-src-container">
<pre><code class="emacs-lisp" id="org573396f">(let ((full-name "Oblivious Observer")
      (full-mail "\"echo 5oyvivbhf?5ofreire[ng]cebgbaznvy?pbz | tr [0-9A-Za-z.?] [5-90-4N-ZA-Mn-za-m?.]\""))
  (setq user-full-name full-name)
  (setq user-mail-address full-mail))
</code></pre>
</div>
</div>
</div>

<div id="outline-container-org2fe278e" class="outline-2">
<h2 id="org2fe278e">Syntax Highlighting</h2>
<div class="outline-text-2" id="text-org2fe278e">
<p>
As I&rsquo;m regularly using a bunch of code blocks and my end goal is to be able to
headlessly build sites using <code>oblivious</code>, I really like the idea of having
syntax highlighting.
</p>

<p>
Sadly <code>htmlize</code>, the default means of <code>org-publish</code> to highlight syntax does not
seem to work in <code>batch</code> mode. The result is that depending on whether or not you
build a site headlessly, you end up with or without syntax highlighting, which
is quite frankly not acceptable, when you&rsquo;ve spent the last two days putting
together something that is supposed to headlessly export org files with syntax
highlighting.
</p>

<p>
An alternative to <code>htmlize</code> is <code>highlight.js</code>, however here you initially run
into the problem that the orgmode export creates source blocks, which look
different than the source blocks <code>highlight.js</code> expects. At some point I <a href="https://old.reddit.com/r/emacs/comments/bhlxmd/where_is_the_proper_way_of_rewriting_or_replacing/elubv0x/">found</a>
the following nice advice, we can simply add into our publish configuration in
order to make it work:
</p>
<div class="org-src-container">
<pre><code class="emacs-lisp" id="org0e51d2f">(defun my/org-html-src-block (html)
  "Modify the output of org-html-src-block for highlight.js"
  (replace-regexp-in-string
   "&lt;/pre&gt;" "&lt;/code&gt;&lt;/pre&gt;"
   (replace-regexp-in-string
    "&lt;pre class=\"src src-\\(.*\\)\"&gt;"
    "&lt;pre&gt;&lt;code class=\"\\1\"&gt;"
    html)))

(advice-add 'org-html-src-block :filter-return #'my/org-html-src-block)
</code></pre>
</div>

<p>
With this in place it is possible to indeed use syntax highlighting with <code>highlight.js</code>.
</p>
</div>
</div>
<div id="outline-container-org388ce2a" class="outline-2">
<h2 id="org388ce2a">Configure org-publish</h2>
<div class="outline-text-2" id="text-org388ce2a">
<p>
We want to set up org-publish for all the files inside this repository.
Initially my Idea was to configure <code>org-publish</code> from within the
<code>.dir-locals.el</code> file, but apparently this does not seem to work. Instead lets
go ahead and inject it into the systems emacs configuration, so we can keep the
configuration of our site local while still using it in our emacs configuration.
</p>

<div class="org-src-container">
<pre><code class="emacs-lisp" id="orge1836cc">(use-package org
  :ensure org-plus-contrib
  :config
  (require 'ox-extra)
  (ox-extras-activate '(ignore-headlines)))

(use-package htmlize
  :ensure t)

(use-package ox-publish
  :init
    (setq my-blog-header-file "~/blog/partials/header.html"
        my-blog-footer-file "~/blog/partials/footer.html"
        org-html-validation-link nil)

    ;; Load partials on memory
    (defun my-blog-header (arg)
      (with-temp-buffer
        (insert-file-contents my-blog-header-file)
        (buffer-string)))

    (defun my-blog-footer (arg)
      (with-temp-buffer
        (insert-file-contents my-blog-footer-file)
        (buffer-string)))

    (defun filter-local-links (link backend info)
    "Filter that converts all the /index.html links to /"
      (if (org-export-derived-backend-p backend 'html)
          (replace-regexp-in-string "/index.html" "/" link)))

    (defun rename-config-page (arg)
      (if (file-exists-p "~/blog/public/config/readme.html")
          (rename-file "~/blog/public/config/readme.html" "~/blog/public/config/index.html" t)))

    (defun my/org-html-src-block (html)
      "Modify the output of org-html-src-block for highlight.js"
      (replace-regexp-in-string
       "&lt;/pre&gt;" "&lt;/code&gt;&lt;/pre&gt;"
       (replace-regexp-in-string
        "&lt;pre class=\"src src-\\(.*\\)\"&gt;"
        "&lt;pre&gt;&lt;code class=\"\\1\"&gt;"
        html)))
    
    (advice-add 'org-html-src-block :filter-return #'my/org-html-src-block)

  :config
    (setq org-html-htmlize-output-type nil)

    (setq org-publish-project-alist
      '(;; Publish the posts
        ("blog-posts"
         :base-directory "~/blog/posts"
         :base-extension "org"
         :publishing-directory "~/blog/public"
         :recursive t
         :publishing-function org-html-publish-to-html
         :headline-levels 4
         :section-numbers nil
         :html-head nil
         :html-head-include-default-style nil
         :html-head-include-scripts nil
         :html-preamble my-blog-header
         :html-postamble my-blog-footer
         )

         ;; For static files that should remain untouched
         ("blog-posts-static"
          :base-directory "~/blog/posts/"
          :base-extension "org\\|css\\|js\\|png\\|jpg\\|gif\\|pdf\\|mp3\\|ogg\\|swf\\|eot\\|svg\\|woff\\|woff2\\|ttf"
          :publishing-directory "~/blog/public"
          :recursive t
          :publishing-function org-publish-attachment
          )

          ;; The static directory contains our index.org landing page for the blog itself:
          ("blog-index"
           :base-directory "~/blog/index"
           :base-extension "org"
           :publishing-directory "~/blog/public"
           ;:preparation-function
           :publishing-function org-html-publish-to-html
           :section-numbers nil
           :html-head nil
           :html-head-include-default-style nil
           :html-head-include-scripts nil
           :html-preamble my-blog-header
           :html-postamble my-blog-footer
           )

          ;; Create the about page from the readme.org file
          ("blog-config"
           :base-directory "~/blog/"
           :publishing-function org-html-publish-to-html
           :publishing-directory "~/blog/public/config/"
           :completion-function rename-config-page
           :exclude ".*"
           :include ["readme.org"]
           :section-numbers nil
;           :html-head-include-scripts nil
           :html-preamble my-blog-header
;           :html-postamble my-blog-footer
           )

          ;; Create the about page from the readme.org file
          ("blog-tags"
           :base-directory "~/blog/tags"
           :publishing-function org-html-publish-to-html
           :publishing-directory "~/blog/public/tags/"
           :exclude ".*"
           :include ["index.org"]
           :section-numbers nil
;           :html-head-include-scripts nil
           :html-preamble my-blog-header
;           :html-postamble my-blog-footer
           )

          ;; Create the graph page from the readme.org file
          ("blog-about"
           :base-directory "~/blog/about"
           :publishing-function org-html-publish-to-html
           :publishing-directory "~/blog/public/about/"
           :exclude ".*"
           :include ["index.org"]
           :section-numbers nil
;           :html-head-include-scripts nil
           :html-preamble my-blog-header
;           :html-postamble my-blog-footer
           )

          ;; CSS static files that should remain untouched
          ("blog-static"
           :base-directory "~/blog/static"
           :base-extension "css\\|js\\|png\\|jpg\\|gif\\|pdf\\|mp3\\|ogg\\|swf\\|eot\\|svg\\|woff\\|woff2\\|ttf\\|txt"
           :publishing-directory "~/blog/public/static"
           :recursive t
           :publishing-function org-publish-attachment
           )

          ;; CSS static files that should remain untouched
          ("blog-assets"
           :base-directory "~/blog/assets"
           :base-extension "css\\|js\\|png\\|jpg\\|gif\\|pdf\\|mp3\\|ogg\\|swf\\|eot\\|svg\\|woff\\|woff2\\|ttf\\|txt"
           :publishing-directory "~/blog/public/static"
           :recursive t
           :publishing-function org-publish-attachment
           )

          ;; Combine the two previous components in a single one
          ("blog" :components ("blog-posts"
                               "blog-posts-static"
                               "blog-index"
                               "blog-config"
                               "blog-static"
                               "blog-tags"
                               "blog-about"
                               "blog-assets"))

          ))

    (add-to-list 'org-export-filter-link-functions 'filter-local-links)
    )
</code></pre>
</div>
</div>
</div>
<div id="outline-container-org31fbacd" class="outline-2">
<h2 id="org31fbacd">Automatically load personal Information</h2>
<div class="outline-text-2" id="text-org31fbacd">
<p>
Now lets create the <code>.dir-locals.el</code> in order to apply this configuration:
</p>
<div class="org-src-container">
<pre><code class="emacs-lisp"> ((org-mode . (
   (eval .
     (let ((full-name "Oblivious Observer")
           (full-mail "\"echo 5oyvivbhf?5ofreire[ng]cebgbaznvy?pbz | tr [0-9A-Za-z.?] [5-90-4N-ZA-Mn-za-m?.]\""))
       (setq user-full-name full-name)
       (setq user-mail-address full-mail))
   )
 )))
</code></pre>
</div>
</div>
</div>
<div id="outline-container-orgaeff818" class="outline-2">
<h2 id="orgaeff818">Resources</h2>
<div class="outline-text-2" id="text-orgaeff818">
<p>
Resources - or dependencies - are neccessary to build a site, but ususally they
are part of their own projects and developed on their own. This section is all
about dealing with stuff like CSS, Fonts and Javascript. 
</p>

<p>
Ideally as a website, we always want to selfhost everything instead of linking
to outside sources. This can be achieved by defining how to download those
dependencies on a per dependency base.
</p>

<p>
Running <code>oblivious fetch</code> will then download all of those resources and put them
wherever it makes sense (e.g. the <code>./static</code> directory).
</p>
</div>
<div id="outline-container-orgb62a976" class="outline-3">
<h3 id="orgb62a976">Github Releases</h3>
<div class="outline-text-3" id="text-orgb62a976">
<p>
For probably most of the resources we want to grab, we can probably grab some sort of github release:
</p>
<div class="org-src-container">
<pre><code class="bash"># e.g.: get_latest_github_release twbs/bootstrap | grep whatever
get_latest_github_release() {
  curl -s https://api.github.com/repos/$1/releases/latest
}
</code></pre>
</div>
</div>
</div>
<div id="outline-container-org6cedd5c" class="outline-3">
<h3 id="org6cedd5c">Bootstrap CSS</h3>
<div class="outline-text-3" id="text-org6cedd5c">
<p>
Big Todo: we are already downloading with the continue flag in wget and storing
the data on <code>/tmp</code> but we are also deleting the zip archive. If we only delete
the rest, we can faster refetch stuff.
</p>

<div class="org-src-container">
<pre><code class="bash">resource_link="$(get_latest_github_release twbs/bootstrap | grep 'browser_download_url.*dist' | cut -d ':' -f2- | tr -d '""')"
resource_archive="$(echo $resource_link | rev | cut -d '/' -f1 | rev)"
resource_name="$(echo $resource_link | rev | cut -d '/' -f1 | rev | sed 's/.zip//')"
mkdir -p /tmp/oblivious/bootstrap
wget -q -c --show-progress $resource_link -P /tmp/oblivious/zipfiles/
unzip -p /tmp/oblivious/zipfiles/$resource_archive $resource_name/css/bootstrap.min.css &gt; ./static/bootstrap.min.css
unzip -p /tmp/oblivious/zipfiles/$resource_archive $resource_name/js/bootstrap.bundle.min.js &gt; ./static/bootstrap.bundle.min.js
unzip -p /tmp/oblivious/zipfiles/$resource_archive $resource_name/js/bootstrap.min.js   &gt; ./static/bootstrap.min.js
# rm -rf /tmp/oblivious/bootstrap
</code></pre>
</div>

<details class="code-details"> <summary> <strong> <font face="Courier" size="3" color="green"> <span style="color:black;">Example bootstrap configuration</span> </font> </strong> </summary> <p>

</p>
<div class="org-src-container">
<pre><code class="org">#+html_head: &lt;link rel="stylesheet" href="/static/bootstrap.min.css"&gt;
#+html_head: &lt;script src="/static/bootstrap.min.js"&gt;&lt;/script&gt;
</code></pre>
</div>
 </details>
</div>
</div>
<div id="outline-container-org87e005b" class="outline-3">
<h3 id="org87e005b">JQuery</h3>
<div class="outline-text-3" id="text-org87e005b">
<div class="org-src-container">
<pre><code class="bash">resource_link="$(get_latest_github_release jquery/jquery | grep 'zipball_url' | cut -d ':' -f2- | tr -d '","')"
resource_archive="$(echo $resource_link | rev | cut -d '/' -f1 | rev)"
resource_name="jquery-jquery-*"
mkdir -p /tmp/oblivious/jquery
wget -q -c --show-progress $resource_link -P /tmp/oblivious/jquery/
unzip -p /tmp/oblivious/jquery/$resource_archive $resource_name/dist/jquery.min.js &gt; ./static/jquery.min.js
unzip -p /tmp/oblivious/jquery/$resource_archive $resource_name/dist/jquery.slim.min.js &gt; ./static/jquery.slim.min.js
rm -rf /tmp/oblivious/jquery
</code></pre>
</div>

<details class="code-details"> <summary> <strong> <font face="Courier" size="3" color="green"> <span style="color:black;">Example bootstrap configuration</span> </font> </strong> </summary> <p>

</p>
<div class="org-src-container">
<pre><code class="org">#+html_head: &lt;script src="/static/jquery.min.js"&gt;&lt;/script&gt;
#+html_head: &lt;script src="/static/jquery.slim.min.js"&gt;&lt;/script&gt;
</code></pre>
</div>
 </details>
</div>
</div>
<div id="outline-container-org46a7b14" class="outline-3">
<h3 id="org46a7b14">Popper.js</h3>
<div class="outline-text-3" id="text-org46a7b14">
<div class="org-src-container">
<pre><code class="bash">resource_version="$(get_latest_github_release popperjs/popper-core | grep 'zipball_url' | cut -d ':' -f2- | tr -d '","' | rev | cut -d '/' -f1 | rev)"
resource_url="https://unpkg.com/browse/@popperjs/core@2.4.4/dist/umd/"
wget -q -c --show-progress $resource_url/popper.min.js -P ./static/
</code></pre>
</div>

<details class="code-details"> <summary> <strong> <font face="Courier" size="3" color="green"> <span style="color:black;">Example bootstrap configuration</span> </font> </strong> </summary> <p>

</p>
<div class="org-src-container">
<pre><code class="org">#+html_head: &lt;script src="/static/popper.min.js"&gt;&lt;/script&gt;
</code></pre>
</div>
 </details>
</div>
</div>
<div id="outline-container-orga53eb79" class="outline-3">
<h3 id="orga53eb79">Google Roboto Font</h3>
<div class="outline-text-3" id="text-orga53eb79">
<div class="org-src-container">
<pre><code class="bash">resource_link="https://fonts.googleapis.com/css?family=Roboto:300,300italic,700,700italic"
wget -q -O- $resource_link | sed 's!https://fonts.gstatic.com/s/roboto/v20/!./static/!' &gt; ./static/roboto.txt
for font_link in $(wget -q $resource_link -O- | tr '()' '\n' | grep https)
do
  wget -q -c --show-progress $font_link -P ./static
done
</code></pre>
</div>

<details class="code-details"> <summary> <strong> <font face="Courier" size="3" color="green"> <span style="color:black;">Example font configuration for Roboto</span> </font> </strong> </summary> <p>

</p>
<div class="org-src-container">
<pre><code class="org">#+html_head: &lt;link rel="stylesheet" href="/static/roboto.txt"&gt;
</code></pre>
</div>
 </details>
</div>
</div>
<div id="outline-container-org7bba8b8" class="outline-3">
<h3 id="org7bba8b8"><span class="todo TODO">TODO</span> Recursive Font</h3>
<div class="outline-text-3" id="text-org7bba8b8">
<p>
<a href="https://www.recursive.design/">https://www.recursive.design/</a>
</p>
</div>
</div>
<div id="outline-container-org9b958b1" class="outline-3">
<h3 id="org9b958b1">Highlight.js</h3>
<div class="outline-text-3" id="text-org9b958b1">
<p>
There is a nice little download service on the highlight.js website, where you
can download a custom release of highlight.js containing all languages you&rsquo;d
like to support. You can simply download it once manually and from then on use a
copy of the request. Also here is an example on how to use cURL with CSRF tokens
etc.:
</p>

<p>
Prepare directory:
</p>
<div class="org-src-container">
<pre><code class="bash">mkdir -p /tmp/oblivious/highlightjs/
</code></pre>
</div>

<p>
Now make an initial request to the highlightjs site in order to obtain the csrf token as well as the csrfmiddlewaretoken from the hidden form field:
</p>
<div class="org-src-container">
<pre><code class="bash">csrfmiddlewaretoken=$(curl -s https://highlightjs.org/download/ -c /tmp/oblivious/highlightjs/cookies.txt | grep "csrfmiddlewaretoken" | tr ' ' '\n' | grep value | cut -d '"' -f2)
token="$(cat /tmp/oblivious/highlightjs/cookies.txt | grep csrf | cut -f 7)"
</code></pre>
</div>

<p>
Now we can fill in the request we initially made, when downloading manually.you
can obtain these requests easily in a browser, e.g. in chromium you can:
</p>
<ul class="org-ul">
<li>press F12</li>
<li>open the Network Tab</li>
<li>press the Download button</li>
<li>right click on the request you are interested in and choose &rsquo;Copy as cURL&rsquo;</li>
</ul>

<div class="org-src-container">
<pre><code class="bash">curl -s 'https://highlightjs.org/download/' \
  -H 'authority: highlightjs.org' \
  -H 'cache-control: max-age=0' \
  -H 'upgrade-insecure-requests: 1' \
  -H 'origin: https://highlightjs.org' \
  -H 'content-type: application/x-www-form-urlencoded' \
  -H 'user-agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.105 Safari/537.36' \
  -H 'accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9' \
  -H 'sec-fetch-site: same-origin' \
  -H 'sec-fetch-mode: navigate' \
  -H 'sec-fetch-user: ?1' \
  -H 'sec-fetch-dest: document' \
  -H 'referer: https://highlightjs.org/download/' \
  -H 'accept-language: en-US,en;q=0.9,de;q=0.8' \
  -H "cookie: csrftoken=$token" \
  --data-raw "csrfmiddlewaretoken=$csrfmiddlewaretoken&amp;properties.js=on&amp;apache.js=on&amp;bash.js=on&amp;c.js=on&amp;csharp.js=on&amp;cpp.js=on&amp;c-like.js=on&amp;css.js=on&amp;coffeescript.js=on&amp;diff.js=on&amp;go.js=on&amp;xml.js=on&amp;http.js=on&amp;json.js=on&amp;java.js=on&amp;javascript.js=on&amp;kotlin.js=on&amp;less.js=on&amp;lua.js=on&amp;makefile.js=on&amp;markdown.js=on&amp;nginx.js=on&amp;objectivec.js=on&amp;php.js=on&amp;php-template.js=on&amp;perl.js=on&amp;plaintext.js=on&amp;python.js=on&amp;python-repl.js=on&amp;ruby.js=on&amp;rust.js=on&amp;scss.js=on&amp;sql.js=on&amp;shell.js=on&amp;swift.js=on&amp;ini.js=on&amp;typescript.js=on&amp;yaml.js=on&amp;armasm.js=on&amp;ada.js=on&amp;accesslog.js=on&amp;arduino.js=on&amp;asciidoc.js=on&amp;abnf.js=on&amp;awk.js=on&amp;basic.js=on&amp;bnf.js=on&amp;cmake.js=on&amp;csp.js=on&amp;clojure.js=on&amp;clojure-repl.js=on&amp;dns.js=on&amp;dts.js=on&amp;django.js=on&amp;dockerfile.js=on&amp;erlang.js=on&amp;erlang-repl.js=on&amp;ebnf.js=on&amp;fortran.js=on&amp;gradle.js=on&amp;haskell.js=on&amp;x86asm.js=on&amp;julia.js=on&amp;julia-repl.js=on&amp;ldif.js=on&amp;llvm.js=on&amp;latex.js=on&amp;lisp.js=on&amp;mathematica.js=on&amp;matlab.js=on&amp;routeros.js=on&amp;nix.js=on&amp;ocaml.js=on&amp;openscad.js=on&amp;ruleslanguage.js=on&amp;pf.js=on&amp;pony.js=on&amp;pgsql.js=on&amp;processing.js=on&amp;prolog.js=on&amp;protobuf.js=on&amp;puppet.js=on&amp;purebasic.js=on&amp;profile.js=on&amp;q.js=on&amp;qml.js=on&amp;r.js=on&amp;reasonml.js=on&amp;scheme.js=on&amp;scilab.js=on&amp;smalltalk.js=on&amp;tcl.js=on&amp;vbscript.js=on&amp;vhdl.js=on&amp;vala.js=on&amp;vim.js=on&amp;vbnet.js=on&amp;crmsh.js=on&amp;dsconfig.js=on" \
  --compressed &gt; /tmp/oblivious/highlightjs/highlightjs.zip
</code></pre>
</div>

<p>
Next unpack the archive and copy the contents to the correct place:
</p>
<ul class="org-ul">
<li>we are only grabbing the github.css here, don&rsquo;t want to take more than we need</li>
</ul>
<div class="org-src-container">
<pre><code class="bash">unzip /tmp/oblivious/highlightjs/highlightjs.zip -d /tmp/oblivious/highlightjs/
mv /tmp/oblivious/highlightjs/highlight.pack.js ./static/
mv /tmp/oblivious/highlightjs/styles/github.css ./static/
rm -rf /tmp/oblivious/highlightjs
</code></pre>
</div>


<details class="code-details"> <summary> <strong> <font face="Courier" size="3" color="green"> <span style="color:black;">Example highlight.js configuration</span> </font> </strong> </summary> <p>

</p>
<div class="org-src-container">
<pre><code class="org">#+html_head: &lt;link rel="stylesheet" href="/static/github.css"&gt;
#+html_head: &lt;script src="/static/highlight.pack.js"&gt;&lt;/script&gt;
#+html_head: &lt;script&gt;hljs.initHighlightingOnLoad();&lt;/script&gt;
</code></pre>
</div>
 </details>
</div>
</div>

<div id="outline-container-org6ff61ad" class="outline-3">
<h3 id="org6ff61ad"><span class="todo TODO">TODO</span> lunr.js</h3>
<div class="outline-text-3" id="text-org6ff61ad">
<ul class="org-ul">
<li>add search using Lunr.js, build the index on release</li>
</ul>
</div>
</div>
<div id="outline-container-org4b7942b" class="outline-3">
<h3 id="org4b7942b">visjs: vis-network</h3>
<div class="outline-text-3" id="text-org4b7942b">
<p>
Apparently vis-network needs to be built, but luckily we can just grab a version
from unpkg:
</p>
<div class="org-src-container">
<pre><code class="bash">wget -q -c --show-progress https://unpkg.com/vis-network/standalone/umd/vis-network.min.js -O ./static/vis-network.min.js
</code></pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org694ac10" class="outline-2">
<h2 id="org694ac10">Assets</h2>
<div class="outline-text-2" id="text-org694ac10">
<p>
Assets are files included into the webisite, but other than resources, they are
not developed on their own. Other than templates assets are usually not
autogenerated from this file and thus versioned with the rest of the project.
Assets are defined in the <code>./assets</code> directory and copied over to the
<code>./public/static</code> directory.
</p>
</div>
</div>
<div id="outline-container-orgcfaf4ed" class="outline-2">
<h2 id="orgcfaf4ed">Templates</h2>
<div class="outline-text-2" id="text-orgcfaf4ed">
<p>
Templates are pieces of configuration, which are glued together in order to
create specific behavior or theming of your site. They can consist of resources,
assets or custom pieces of code.
</p>

<p>
Templates can for example be created in the form of org files under the
templates directory and then include those using <code>#+setupfile:</code> or <code>#+include</code>.
</p>
</div>
<div id="outline-container-org6622072" class="outline-3">
<h3 id="org6622072">Bootstrap</h3>
<div class="outline-text-3" id="text-org6622072">
<p>
Lets import the Bootstrap  CSS and Javascript stuff (apparently Bootstrap wants to load jquery, then popper, then bootstrap stuff):
</p>
<div class="org-src-container">
<pre><code class="org">#+html_head: &lt;script src="/static/jquery.min.js"&gt;&lt;/script&gt;
#+html_head: &lt;script src="/static/jquery.slim.min.js"&gt;&lt;/script&gt;
#+html_head: &lt;script src="/static/popper.min.js"&gt;&lt;/script&gt;
</code></pre>
</div>

<div class="org-src-container">
<pre><code class="org">#+html_head: &lt;link rel="stylesheet" href="/static/bootstrap.min.css"&gt;
#+html_head: &lt;script src="/static/bootstrap.min.js"&gt;&lt;/script&gt;
#+html_head: &lt;script src="/static/bootstrap.bundle.min.js"&gt;&lt;/script&gt;
</code></pre>
</div>

<p>
We want to have the Roboto Fonts available (actually not sure if Bootstrap uses
them..) I&rsquo;ll have to look that one up:
</p>
<div class="org-src-container">
<pre><code class="org">#+html_head: &lt;link rel="stylesheet" href="/static/roboto.txt"&gt;
</code></pre>
</div>

<p>
Lets also apply some padding, so the site looks centered:
</p>
<div class="org-src-container">
<pre><code class="org">#+html_head: &lt;style type="text/css"&gt;body{ padding: 5em 20%;}&lt;/style&gt;
</code></pre>
</div>

<p>
The default Bootstrap color for code was purple, lets make it grey instead:
</p>
<div class="org-src-container">
<pre><code class="org">#+html_head: &lt;style type="text/css"&gt;code { color: #808080;}&lt;/style&gt;
</code></pre>
</div>

<p>
And finally lets reduce the Padding for the <code>pre</code> class. This is due to the fact
that we also use <code>highlight.js</code> and have to use a bit of nifty advice to make
sure that org-mode exports to html in a format that <code>highlight.js</code> is able to
understand: Basically we end up creating <code>code</code> inside of the previous <code>code</code>
environments and with this new export behavior, the default of <code>8pt</code> padding for
<code>pre</code> looks rather bad.
</p>
<div class="org-src-container">
<pre><code class="org">#+html_head: &lt;style type="text/css"&gt;pre { padding: 0pt;}&lt;/style&gt;
</code></pre>
</div>

<p>
For the navbar lets disable padding and margins:
</p>
<div class="org-src-container">
<pre><code class="org">#+html_head: &lt;style type="text/css"&gt;.navbar { margin:0 !important; padding: 0px !important; } &lt;/style&gt;
</code></pre>
</div>
</div>
</div>
<div id="outline-container-org1356072" class="outline-3">
<h3 id="org1356072">Monospaced Title Font</h3>
<div class="outline-text-3" id="text-org1356072">
<div class="org-src-container">
<pre><code class="org">#+html_head: &lt;style type="text/css"&gt; .title{ font-family: SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace; }&lt;/style&gt;
#+html_head: &lt;style type="text/css"&gt; .title{ color: #808080; font-weight: 500; line-height: 1.2; }&lt;/style&gt;
</code></pre>
</div>
</div>
</div>
<div id="outline-container-org268faa4" class="outline-3">
<h3 id="org268faa4"><span class="todo TODO">TODO</span> Syntax Highlighting in batch mode</h3>
<div class="outline-text-3" id="text-org268faa4">
<div class="org-src-container">
<pre><code class="org">#+html_head: &lt;link rel="stylesheet" href="/static/github.css"&gt;
#+html_head: &lt;script src="/static/highlight.pack.js"&gt;&lt;/script&gt;
#+html_head: &lt;script&gt;hljs.initHighlightingOnLoad();&lt;/script&gt;
</code></pre>
</div>
</div>
</div>
<div id="outline-container-org20d1a43" class="outline-3">
<h3 id="org20d1a43">Floating Table of Contents</h3>
<div class="outline-text-3" id="text-org20d1a43">
<p>
This is taken from worg.css:
</p>
<div class="org-src-container">
<pre><code class="css">/*TOC inspired by https://orgmode.org/worg/ */
#table-of-contents {
    /* Place the toc in the top right corner */
    position: fixed; right: 0em; top: 0em;
    margin-top: 120px; /* offset from the top of the screen */

    /* It shrinks and grows as necessary */
    padding: 0em !important;
    width: auto !important;
    min-width: auto !important;

    font-size: 10pt;
    background: white;
    line-height: 12pt;
    text-align: right;

    box-shadow: 0 0 1em #777777;
    -webkit-box-shadow: 0 0 1em #777777;
    -moz-box-shadow: 0 0 1em #777777;
    -webkit-border-bottom-left-radius: 5px;
    -moz-border-radius-bottomleft: 5px;

    /* Ensure doesn't flow off the screen when expanded */
    max-height: 80%;
    overflow: auto;}

/* How big is the text “Table of Contents” and space around it */
#table-of-contents h2 {
    font-size: 13pt;
    max-width: 9em;
    border: 0;
    font-weight: normal;
    padding-left: 0.5em;
    padding-right: 0.5em;
    padding-top: 0.05em;
    padding-bottom: 0.05em; }

/* Intially have the TOC folded up; show it if the mouse hovers it */
#table-of-contents #text-table-of-contents {
    display: none;
    text-align: left; }

#table-of-contents:hover #text-table-of-contents {
    display: block;
    padding: 0.5em;
    margin-top: -1.5em; }
</code></pre>
</div>

<div class="org-src-container">
<pre><code class="org">#+html_head: &lt;link rel="stylesheet" href="/static/floating-toc.css"&gt;
</code></pre>
</div>
</div>
</div>
<div id="outline-container-orgb550443" class="outline-3">
<h3 id="orgb550443"><span class="todo TODO">TODO</span> Table of Content as part of Navbar</h3>
<div class="outline-text-3" id="text-orgb550443">
<p>
Just an idea, but it would be kind of cool to have it either at the side of the
page or as part of the stickt navbar with the option to drop down.
</p>
</div>
</div>
<div id="outline-container-org87b5468" class="outline-3">
<h3 id="org87b5468">Navigation</h3>
<div class="outline-text-3" id="text-org87b5468">
<p>
This one is the navigation bar I use, it is included as html header file. Not
sure if that is the best way to go about this. I would really like an option to
overwrite the custom header for some pages.
</p>

<p>
Notes:
</p>
<ul class="org-ul">
<li>The <code>fixed-top</code> class makes the navbar work without margins etc.</li>
</ul>

<div class="org-src-container">
<pre><code class="html">&lt;nav class="navbar fixed-top navbar-expand-lg navbar-light bg-light"&gt;
  &lt;div class="container"&gt;

  &lt;a class="navbar-brand" href="/"&gt; &lt;img src="/static/observer.png" width="35" height="35" class="d-inline-block align-top" alt=""&gt; &lt;/a&gt;


  &lt;button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"&gt;
    &lt;span class="navbar-toggler-icon"&gt;&lt;/span&gt;
  &lt;/button&gt;

  &lt;div class="collapse navbar-collapse" id="navbarSupportedContent"&gt;
    &lt;ul class="nav navbar-nav ml-auto w-100 justify-content-left"&gt;
      &lt;li class="nav-item"&gt;
        &lt;a class="nav-link" href="/"&gt; Oblivious Observer &lt;/a&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
    &lt;ul class="nav navbar-nav ml-auto w-100 justify-content-end"&gt;
      &lt;li class="nav-item"&gt;
        &lt;a class="nav-link" href="/about"&gt;about&lt;/a&gt;
      &lt;/li&gt;
      &lt;li class="nav-item"&gt;
        &lt;a class="nav-link" href="/config"&gt;config&lt;/a&gt;
      &lt;/li&gt;
      &lt;li class="nav-item"&gt;
        &lt;a class="nav-link" href="https://github.com/observer/observer.github.io"&gt;src&lt;/a&gt;
      &lt;/li&gt;
      &lt;li class="nav-item"&gt;
        &lt;a class="nav-link" href="/tags"&gt;tags&lt;/a&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/div&gt;
  &lt;/div&gt;
&lt;/nav&gt;
</code></pre>
</div>
</div>
</div>
<div id="outline-container-orgd01be45" class="outline-3">
<h3 id="orgd01be45"><span class="todo TODO">TODO</span> Remove unused stuff</h3>
<div class="outline-text-3" id="text-orgd01be45">
<p>
Is it possible to remove all files which aren&rsquo;t referenced by a linked
automatically in order to avoid dead directories etc?
</p>

<p>
Basically there is the entry site as well as some posts (which are linked) and
resources (images, css, javascript), which usually are also referenced in some
way.
</p>

<p>
If a site is not linked by anything and if this site is not the entrypoint to
your website, then it could be unnecessary to keep it in the public folder.
</p>

<p>
Only thing necessary apart from that would be a whitlist.
</p>
</div>
</div>
<div id="outline-container-org06fcaa4" class="outline-3">
<h3 id="org06fcaa4">Simple Post List</h3>
<div class="outline-text-3" id="text-org06fcaa4">
<p>
In order to use this post list, the first line of the file needs to contain this:
</p>
<pre class="example">
# -*- org-confirm-babel-evaluate: nil; -*-
</pre>

<p>
We can use a nifty little block of bash in order to create some links to out
posts, which are ordered by date:
</p>

<div class="org-src-container">
<pre><code class="org">#+name: posts_list0
#+BEGIN_SRC bash :exports none :output org :results raw :cache no
for filename in $(ls ../posts)
do
  post_title=$(head ../posts/$filename/index.org | grep -i "#+title:" | cut -d':' -f2)
  post_date=$(head ../posts/$filename/index.org | grep -i "#+date:" | cut -d':' -f2)

  echo "- $post_date [[../$filename/index.html][$post_title]]"
done | sort -rn
#+END_SRC

#+CALL: posts_list0()
</code></pre>
</div>
</div>
</div>
<div id="outline-container-org4bfcc75" class="outline-3">
<h3 id="org4bfcc75">Bootstrap Post List</h3>
<div class="outline-text-3" id="text-org4bfcc75">
<p>
In order to use this post list, the first line of the file needs to contain this:
</p>
<pre class="example">
# -*- org-confirm-babel-evaluate: nil; -*-
</pre>

<p>
This Post list is a bit more complicated. It will output an HTML export block,
which contains raw html.
</p>

<div class="org-src-container">
<pre><code class="org"># disable sub/superscripting
#+OPTIONS: ^:nil

#+name: bootstrap_posts_list
#+BEGIN_SRC bash :exports none :output raw :results raw :cache no
echo '#+BEGIN_EXPORT html'
echo '&lt;div class="list-group"&gt;'

order_posts_by_date() {
for post_name in $(ls ../posts)
do
  post_date=$(head ../posts/$post_name/index.org | grep -i "#+date:" | cut -d'&lt;' -f2 | cut -d' ' -f1)  
  
  echo "$post_date;$post_name"
done | sort -rn
}

filetags() {
  post_name="$1"
  tags="$(head ../posts/$post_name/index.org | grep -i "#+filetags:" | cut -d':' -f2-)"

  for t in $(echo $tags | tr ':' '\n' | sort | tr '\n' ' '); do
    if [ "$t" == "draft" ]; then
      badge_type="badge-danger";
    else                            
      badge_type="badge-secondary"
    fi
    echo "&lt;span class=\"badge $badge_type\"&gt;$(echo $t | sed 's/_/ /g')&lt;/span&gt;"
  done 
}

for post in $(order_posts_by_date); do
  post_date="$(echo $post | cut -d';' -f1 | awk -F'-' '{ print $3"."$2"."$1}')"
  post_name="$(echo $post | cut -d';' -f2)"
  post_title="$(head ../posts/$post_name/index.org | grep -i "#+title:" | cut -d':' -f2-)"
  post_description="$(head ../posts/$post_name/index.org | grep -i "#+description:" | cut -d':' -f2-)"
  
  echo "  
  &lt;a href=\"/$post_name\" class=\"list-group-item list-group-item-action flex-column align-items-start\"&gt;
    &lt;div class=\"d-flex w-100 justify-content-between\"&gt;
      &lt;h5 class=\"mb-1\"&gt;$post_title&lt;/h5&gt;
      &lt;small&gt;$post_date&lt;/small&gt;
    &lt;/div&gt;
    &lt;p class=\"mb-1\"&gt;$post_description&lt;/p&gt;
    &lt;small&gt;$(filetags $post_name)&lt;/small&gt;
  &lt;/a&gt;
  "
done

echo '&lt;/div&gt;'
echo '#+END_EXPORT'
#+END_SRC

#+CALL: bootstrap_posts_list()
</code></pre>
</div>
</div>
</div>
<div id="outline-container-orgfaf872d" class="outline-3">
<h3 id="orgfaf872d">Tags</h3>
<div class="outline-text-3" id="text-orgfaf872d">
<p>
Create Tags page or multiple Tag pages.. (associative arrays?)
</p>

<p>
This generates a page containing a list of posts. The following block will
create <code>./tags/index.org</code>, which will be used to dynamically create a taglist,
every time we publish:
</p>

<div class="org-src-container">
<pre><code class="org"># -*- org-confirm-babel-evaluate: nil; -*-
#+title: Tags
#+include: ../templates/default.org
#+include: ../templates/knowledge_graph.org

#+OPTIONS: toc:nil
# disable sub/superscripting
#+OPTIONS: ^:nil

#+begin_center
Doubleclick on the Nodes in order to jump to a tag or to open a blogpost.
#+end_center

#+name: generate_tag_list
#+BEGIN_SRC bash :exports none :output raw :results raw :cache no
echo '#+BEGIN_EXPORT html'

declare -A tags

collect_tags() {
for post_name in $(ls ../posts)
do
  post_date="$(head ../posts/$post_name/index.org | grep -i "#+date:" | grep -i "#+date:" | cut -d':' -f2 | tr -d '&lt;&gt;TheMoWFidSaturn ' | awk -F'-' '{ print $3"."$2"."$1}')"
  post_tags="$(head ../posts/$post_name/index.org | grep -i "#+filetags:" | cut -d':' -f2- | tr ':' ' ')"
  for t in $post_tags; do

    tags[$t]="${tags[$t]} $post_date:$post_name"
  done
done

for t in $(echo ${!tags[@]} | tr ' ' '\n' | sort | tr '\n' ' '); do
  tag="$(echo "$t" | tr '_' ' ')"
echo "
&lt;div class="card border-dark mb-3" style=""&gt;
  &lt;a id="$tag"&gt;
  &lt;div class="card-header"&gt;$tag&lt;/div&gt;
  &lt;div class="card-body text-dark"&gt;
"
  for p in $(echo ${tags[$t]} | tr ' ' '\n' | sort -rn | tr '\n' ' ') ; do
    post_date="$(echo $p | cut -d':' -f1)"
    post="$(echo $p | cut -d':' -f2)"
    post_name="$(echo $post | cut -d';' -f2)"
    post_title="$(head ../posts/$post_name/index.org | grep -i "#+title:" | cut -d':' -f2-)"
    post_description="$(head ../posts/$post_name/index.org | grep -i "#+description:" | cut -d':' -f2-)"

echo "
    &lt;a href=\"/$post_name\" class=\"list-group-item list-group-item-action flex-column align-items-start\"&gt;
      &lt;div class=\"d-flex w-100 justify-content-between\"&gt;
        &lt;h5 class=\"mb-1\"&gt;$post_title&lt;/h5&gt;
        &lt;small&gt;$post_date&lt;/small&gt;
      &lt;/div&gt;
      &lt;p class=\"mb-1\"&gt;$post_description&lt;/p&gt;
    &lt;/a&gt;
"

  done
echo "
  &lt;/div&gt;
&lt;/div&gt;
&lt;hr&gt;
"
done
}

collect_tags

echo '#+END_EXPORT'
#+END_SRC

#+CALL: generate_tag_list()
</code></pre>
</div>
</div>
</div>
<div id="outline-container-org89543a4" class="outline-3">
<h3 id="org89543a4">Clean up dead links / resources</h3>
<div class="outline-text-3" id="text-org89543a4">
<pre class="example">
grep -rnw "href" | grep -v "^static/" | tr ' ' '\n' | grep href | sort | uniq | grep -v '\\"\|&amp;gt' | grep "static"
</pre>
</div>
</div>
<div id="outline-container-org3feeea3" class="outline-3">
<h3 id="org3feeea3"><span class="todo TODO">TODO</span> Mathjax</h3>
</div>
<div id="outline-container-orge0909b6" class="outline-3">
<h3 id="orge0909b6"><span class="todo TODO">TODO</span> PubCSS</h3>
<div class="outline-text-3" id="text-orge0909b6">
<p>
Not sure if this one is any good:
</p>
<ul class="org-ul">
<li><a href="https://github.com/thomaspark/pubcss">https://github.com/thomaspark/pubcss</a></li>
</ul>
</div>
</div>
<div id="outline-container-orged5bcfc" class="outline-3">
<h3 id="orged5bcfc">Knowledge Graph</h3>
<div class="outline-text-3" id="text-orged5bcfc">
<p>
I&rsquo;ve had this idea to connect posts using their tags for a while now. The
following code is using vis.js to generate a graph connecting posts and tags.
</p>

<p>
Double clicking on the nodes will open the blog post or jump to the tag.
</p>

<div class="org-src-container">
<pre><code class="org"># -*- org-confirm-babel-evaluate: nil; -*-
# ,#+html_head: &lt;script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"&gt;&lt;/script&gt;
#+html_head: &lt;script type="text/javascript" src="/static/vis-network.min.js"&gt;&lt;/script&gt;
#+html_head: &lt;style type="text/css"&gt; #mynetwork { width: 100%; height: 600px; border: 0px solid lightgray; } &lt;/style&gt;

#+name: generate_graph
#+BEGIN_SRC bash :exports none :output raw :results raw :cache no
echo '#+BEGIN_EXPORT html'

declare -A tags
declare -A tag_ids
edgelist=""
post_id="1"

echo "
&lt;div id=\"mynetwork\"&gt;&lt;/div&gt;
&lt;script type=\"text/javascript\"&gt;
  // create an array with nodes
  var nodes = new vis.DataSet([
"

for post_name in $(ls ../posts)
do
  post_tags="$(head ../posts/$post_name/index.org | grep -i "#+filetags:" | cut -d':' -f2- | tr ':' ' ')"
  post_title="$(head ../posts/$post_name/index.org | grep -i "#+title:" | cut -d':' -f2- | awk '{$1=$1};1' | fold -s -w 20 | tr '\n' '&amp;' | sed 's/&amp;/\\n/g' | rev | cut -c 3- | rev | tr -d '\n')"

for t in $post_tags; do
    tags[$t]="${tags[$t]} $post_id"
  done
  echo "{id: $post_id, label: '$post_title', url: '/$post_name'}",
  post_id=$(($post_id + 1))
done

for K in "${!tags[@]}"; do
  weight="$(echo ${tags[$K]} | tr ' ' '\n' | wc -l)"
    
  tag_ids[$K]="$post_id" 
  echo "{id: $post_id, shape: 'dot', label: '$(echo $K|tr '_' ' ')', value:'$weight', url: '/tags/#$K'},"
  post_id=$(($post_id + 1))
done

echo "
  ]);

  // create an array with edges
  var edges = new vis.DataSet([
"

for K in "${!tags[@]}"; do 
  for to in ${tags[$K]}; do 
    echo "    {from: ${tag_ids[$K]}, to: $to},"
  done
done

echo "
  ]);

  // create a network
  var container = document.getElementById('mynetwork');
  var data = {
    nodes: nodes,
    edges: edges
  };
  var options = {
    width: '100%',
    height: '100%',

    shape: \"dot\",
    nodes: {
      shape: 'box'
    },
    physics: {
      "barnesHut": {
        "springConstant": 0,
        "avoidOverlap": 0.5
      },
    }
  };
  var network = new vis.Network(container, data, options);

  network.on( 'doubleClick', function(properties) {
    console.log('clicked node ' + properties.nodes);
    if(!properties.nodes.length) return;
    var node = nodes.get(properties.nodes[0]);
    window.location.replace(node.url);
  });
&lt;/script&gt;
"

echo '#+END_EXPORT'
#+END_SRC

#+CALL: generate_graph()
</code></pre>
</div>
</div>
</div>
<div id="outline-container-orgd53b974" class="outline-3">
<h3 id="orgd53b974">Comments</h3>
<div class="outline-text-3" id="text-orgd53b974">
<p>
Comments can be set up using github issues. There is even an official github
project called utterances, which takes care of everything. Everything works by
adding a few little lines of javascript to the bottom of your posts. Then either
a bot sets up an issue automatically or you have to set one up by hand and link
reference it manually. For now I&rsquo;ll just use the bot, since it seems to be quite
convenient.
</p>

<p>
Since it does probably not make any sense to update the client.js manually I&rsquo;ll
just reference it here:
</p>
<div class="org-src-container">
<pre><code class="org">#+name: add_comments
#+BEGIN_SRC bash :exports none :output raw :results raw :cache no
echo '#+BEGIN_EXPORT html'
echo "
&lt;script src="https://utteranc.es/client.js"
        repo="observer/observer.github.io"
        issue-term="url"
        label="💬"
        theme="github-light"
        crossorigin="anonymous"
        async&gt;
&lt;/script&gt;
"
echo '#+END_EXPORT'
#+END_SRC

#+CALL: add_comments()
</code></pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org3842ec0" class="outline-2">
<h2 id="org3842ec0">Collections</h2>
<div class="outline-text-2" id="text-org3842ec0">
<p>
Template collections are used to combine atomic configuration set up in
templates into configuration, which is used for groups of posts.
</p>

<p>
For now template collections are also housed inside of the templates directory.
</p>
</div>
<div id="outline-container-orgca377f0" class="outline-3">
<h3 id="orgca377f0">Default</h3>
<div class="outline-text-3" id="text-orgca377f0">
<p>
The default setup for all of the blog posts.
</p>
<div class="org-src-container">
<pre><code class="org">#+OPTIONS: html-postamble:nil
#+OPTIONS: toc:nil
#+include: ./bootstrap.org
#+include: ./syntax-highlighting.org
</code></pre>
</div>
</div>
</div>
<div id="outline-container-orge0e6ef5" class="outline-3">
<h3 id="orge0e6ef5">Default Init</h3>
<div class="outline-text-3" id="text-orge0e6ef5">
<p>
This houses the default settings for the init page (which contains information
about <code>oblivious</code> and on how to set up this site).
</p>
<div class="org-src-container">
<pre><code class="org">#+OPTIONS: html-postamble:nil
#+OPTIONS: toc:nil
#+include: ./bootstrap.org
#+include: ./monospace-title-font.org
#+include: ./syntax-highlighting.org
</code></pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb5124ec" class="outline-2">
<h2 id="orgb5124ec">Signing your releases</h2>
<div class="outline-text-2" id="text-orgb5124ec">
<p>
I spent some time thinking about whether or not to sign the releases of these
blog posts or not. There are a bunch of options when it comes to using gpg with
your releases, e.g. using github, you can automatically sign your commits with a
key belonging to your mailaddress. instead of signing commits, I decided to sign
all files in the release using a gpg key, which I&rsquo;ll put into the about page.
</p>

<p>
First a gpg key has to be created:
</p>
<pre class="example">
gpg --generate-full-key
</pre>

<p>
Next note the secret key id:
</p>
<pre class="example">
sec   rsa4096/74344F2BCE39AA5D 2020-08-25 [SC]
      48A1CC122B2B6E37FDA4B7B474344F2BCE39AA5D
uid                 [ultimate] Oblivious Observer &lt;oblivious@observer&gt;
ssb   rsa4096/2148A87445434332 2020-08-25 [E]
</pre>

<p>
The public key can be exported using:
</p>
<pre class="example">
gpg --armor --output public-key.gpg --export oblivious@observer
</pre>

<p>
And imported using:
</p>
<pre class="example">
gpg --import public-key.gpg
</pre>

<p>
This ID can then be used in order to autosign all files from the public
directory:
</p>
<div class="org-src-container">
<pre><code class="bash">#!/usr/bin/env bash
pwd

for f in $(find -L public/ | grep '.sig$'); do
    rm $f
done

./bin/oblivious build

for f in $(find -L public/ | grep -v ".git"); do
  if ! [ -d "$f" ]; then
    gpg -u 48A1CC122B2B6E37FDA4B7B474344F2BCE39AA5D --output $f.sig --detach-sig $f
  fi
done
</code></pre>
</div>

<p>
Verification of the files can be done like this:
</p>
<pre class="example">
gpg --verify path/to/index.html.sig path/to/index.html
</pre>

<p>
A version of this sites public key can be found on the <a href="../about/">about</a> page.
</p>
</div>
</div>


<script src=https://utteranc.es/client.js
        repo=observer/observer.github.io
        issue-term=url
        label=💬
        theme=github-light
        crossorigin=anonymous
        async>
</script>
</div>
</body>
</html>
